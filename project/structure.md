# Структура проекта admin_p2p

admin_p2p/
├── prisma/                     # Директория с файлами Prisma
│   ├── schema.prisma           # Схема базы данных
│   └── seed.ts                 # Скрипт для начального заполнения БД
│
├── public/                     # Статические файлы
│
├── src/                        # Исходный код
│   ├── app/                    # Директория приложения Next.js
│   │   ├── api/                # API Routes
│   │   │   └── [...trpc]/      # tRPC API endpoint
│   │   ├── login/              # Страница авторизации
│   │   │   └── page.tsx        # Компонент страницы входа
│   │   ├── users/              # Страница пользователей
│   │   │   └── page.tsx        # Компонент страницы пользователей
│   │   ├── settings/           # Страница настроек
│   │   │   └── page.tsx        # Компонент страницы настроек
│   │   ├── transactions/       # Страница транзакций
│   │   │   └── page.tsx        # Компонент страницы транзакций
│   │   ├── salary/             # Страница зарплат
│   │   │   └── page.tsx        # Компонент страницы зарплат
│   │   ├── finances-tractor/    # Страница финансового трактора
│   │   │   └── page.tsx        # Компонент страницы финансового трактора
│   │   ├── idex-cabinets/      # Страница кабинетов IDEX
│   │   │   ├── page.tsx        # Компонент страницы кабинетов IDEX
│   │   │   └── sync-history/   # История синхронизаций (устаревшая, теперь используется модальное окно)
│   │   │       └── page.tsx    # Компонент страницы истории синхронизаций
│   │   ├── layout.tsx          # Корневой серверный макет
│   │   └── page.tsx            # Главная страница (Dashboard)
│   │
│   ├── components/             # Переиспользуемые компоненты
│   │   ├── dashboard/          # Компоненты дашборда
│   │   │   ├── StatCard.tsx    # Карточка статистики
│   │   │   ├── UsersTable.tsx  # Таблица пользователей
│   │   │   └── index.ts        # Индексный файл с экспортами
│   │   │
│   │   ├── layout/             # Компоненты макета
│   │   │   ├── AppHeader.tsx   # Шапка приложения
│   │   │   ├── Sidebar.tsx     # Боковая панель
│   │   │   └── index.ts        # Индексный файл с экспортами
│   │   │
│   │   ├── providers/          # Провайдеры приложения
│   │   │   ├── ThemeProvider.tsx # Провайдер темы (темная/светлая)
│   │   │   ├── AuthProvider.tsx  # Провайдер аутентификации
│   │   │   ├── Providers.tsx     # Общий компонент для всех провайдеров
│   │   │   └── index.ts          # Индексный файл с экспортами
│   │   │
│   │   ├── idex/               # Компоненты для IDEX
│   │   │   ├── IdexCabinetsTable.tsx   # Таблица кабинетов IDEX
│   │   │   └── IdexSyncOrdersModal.tsx # Модальное окно для просмотра запросов на синхронизацию
│   │   │
│   │   └── ui/                 # UI компоненты
│   │       ├── Button.tsx      # Компонент кнопки
│   │       └── index.ts        # Индексный файл с экспортами
│   │
│   ├── server/                 # Серверный код
│   │   ├── api/                # API роутеры
│   │   │   ├── routers/        # tRPC роутеры
│   │   │   │   ├── auth.ts     # Роутер для аутентификации
│   │   │   │   ├── financeTractor.ts # Роутер для финансового трактора
│   │   │   │   ├── users.ts    # Роутер для работы с пользователями
│   │   │   │   ├── salary.ts   # Роутер для работы с зарплатами
│   │   │   │   └── transactions.ts # Роутер для работы с транзакциями
│   │   │   ├── trpc.ts         # Конфигурация tRPC
│   │   │   └── root.ts         # Корневой роутер
│   │   │
│   │   └── db.ts               # Конфигурация Prisma
│   │
│   ├── stores/                 # Хранилища данных (Zustand)
│   │   ├── authStore.ts        # Хранилище для аутентификации
│   │   ├── themeStore.ts       # Хранилище для настроек темы
│   │   ├── usersStore.ts       # Хранилище для пользователей
│   │   └── salaryStore.ts      # Хранилище для зарплат
│   │
│   ├── types/                  # Типы и интерфейсы
│   │   └── index.ts            # Основные типы приложения
│   │
│   ├── trpc/                   # Клиентская настройка tRPC
│   │   ├── client.ts           # Клиентский tRPC
│   │   └── react.ts            # React хуки для tRPC
│   │
│   ├── utils/                  # Утилиты и хелперы
│   │   └── utils.ts            # Общие утилиты (например, cn для классов)
│   │
│   ├── env.ts                  # Переменные окружения
│   └── styles/                 # Стили
│       └── globals.css         # Глобальные стили
│
├── project/                    # Документация проекта
│   ├── history.md              # История изменений
│   ├── structure.md            # Структура проекта
│   ├── tech.md                 # Используемые технологии
│   └── requests.md             # Архив запросов пользователя
│
├── tailwind.config.ts          # Конфигурация Tailwind CSS
├── next.config.js              # Конфигурация Next.js
├── tsconfig.json               # Конфигурация TypeScript
├── package.json                # Зависимости проекта
└── README.md                   # Описание проекта

## Основные компоненты и их функциональность

### Аутентификация
- **login/page.tsx** - Страница входа с вводом кода доступа
- **AuthProvider.tsx** - Провайдер для доступа к аутентификации в компонентах
- **authStore.ts** - Хранилище с логикой аутентификации и персистентностью

### Типы пользователей
- **UserWithTelegram** - Пользователь с телеграм аккаунтами (из API)
- **UserFromStorage** - Пользователь из localStorage
- **AuthUser** - Объединенный тип для работы с разными форматами

### Авторизация
- Работает через токены, генерируемые при успешной авторизации
- Сессия сохраняется в localStorage через Zustand middleware persist
- Поддерживает различные роли пользователей (admin/user)

### Интерфейс
- Главный макет разделен на боковое меню (Sidebar) и основной контент
- В боковом меню отображается текущий пользователь и навигация
- AppHeader отображает информацию о текущей странице в верхней части
- Дизайн соответствует стилю Apple с использованием HeroUI компонентов

### Навигация
- Реализована с использованием навигации Next.js и компонентов Link
- Защищенные маршруты проверяют аутентификацию через AuthProvider

### Страницы

#### Matches (`/matches`)
- Отображение всех сопоставленных транзакций между телеграмм и IDEX
- Включает фильтры по дате, пользователю и статусу транзакции
- Отображает идентификаторы транзакций, ID IDEX кабинета, суммы и прибыль
- Предоставляет функцию экспорта данных в CSV формат
- Содержит различные вкладки для просмотра всех сопоставлений, сопоставлений по выбранному пользователю и статистики

#### Зарплаты (`/salary`)
- Отображение таблицы сотрудников с полной информацией (ФИО, должность, дата начала работы)
- Информация о дне выплаты зарплаты (день месяца или конкретная дата в году)
- Отображение фиксированной зарплаты или указание на нефиксированную оплату
- История выплат с возможностью добавления новых записей
- Поддержка комментариев к выплатам
- Поиск и фильтрация по ФИО и должности сотрудников
- Формы для добавления новых сотрудников и выплат
- Пагинация результатов для удобной навигации

### Модели данных
- **Salary** - Модель для хранения информации о сотрудниках и их зарплатах
  - Связана с SalaryPayment через отношение один-ко-многим
  - Содержит информацию о сотруднике, дате начала работы, дне выплаты и фиксированной зарплате
- **SalaryPayment** - Модель для хранения истории выплат сотрудникам
  - Связана с Salary через внешний ключ
  - Содержит сумму выплаты, дату и опциональный комментарий
- **IdexSyncOrder** - Модель для хранения информации о запросах на синхронизацию IDEX кабинетов
  - Связана с IdexCabinet через cabinetId
  - Содержит информацию о статусе выполнения запроса (PENDING, IN_PROGRESS, COMPLETED, FAILED)
  - Хранит временные метки (createdAt, startSyncAt, endSyncAt) и данные об обработанных транзакциях
- **FinRow** - Модель для хранения финансовых записей
  - Содержит информацию о дате, смене, начальном и конечном балансе в разных валютах (RUB, USDT)
  - Связана с EmployeeSalaryPayment через отношение один-ко-многим для учета выплат сотрудникам
  - Поддерживает добавление комментариев к финансовым операциям
- **EmployeeSalaryPayment** - Модель для выплат сотрудникам, связанных с финансовыми записями
  - Связана с FinRow через внешний ключ (finRowId)
  - Содержит информацию о сотруднике, сумме выплаты, валюте и дате
  - Позволяет добавлять комментарии к выплатам

### Финансовый трактор (`/finances-tractor`)
- Модуль для управления финансовыми операциями и денежными потоками
- Отслеживание начального и конечного баланса за смены в разных валютах (RUB, USDT)
- Разделение на утренние и вечерние смены для более подробной аналитики
- Поддержка регистрации расходов различных типов (фиксированные и переменные)
- Возможность записи выплат сотрудникам в момент создания финансовой записи
- Формирование отчетов о финансовых операциях за выбранный период
- Фильтрация и поиск финансовых записей по различным параметрам
