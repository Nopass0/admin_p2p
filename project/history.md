# История изменений проекта

## 19.03.2025
- Реорганизация структуры макета с правильным позиционированием сайдбара
- Исправлено дублирование сайдбара в layout.tsx и page.tsx
- Внедрена гибкая flexbox-структура с сайдбаром слева и основным контентом справа
- Оптимизирован верхний уровень компонентов для соответствия лучшим практикам Next.js

## 20.03.2025
- Обновление файла root.ts - добавление новых маршрутизаторов (auth, users, transactions)
- Исправление ошибок типизации в authStore.ts (корректировка типа adminData)
- Исправление ошибок типизации в users.ts (корректная работа с фильтрами Prisma)
- Исправление ошибок типизации в transactions.ts (проверки на undefined значения)
- Добавлен столбец "ID IDEX кабинета" в таблицы сопоставлений транзакций
- Обновлен запрос getAllMatches для включения информации о кабинете IDEX в ответе
- Расширен функционал экспорта в CSV для включения идентификатора кабинета IDEX
- Улучшено отображение данных на странице matches для упрощения идентификации транзакций

## 21.03.2025
### Фильтрация транзакций по кабинетам IDEX
- Добавлена поддержка параметра `cabinetIds` во все основные методы API для фильтрации транзакций
- Реализован метод `getCabinetMatchStats` для получения статистики по выбранным кабинетам
- Добавлена функция `calculateTotalStats` для расчета общей статистики сопоставлений
- Исправлена ошибка экспорта маршрутизатора `matchRouter`
- Обновлена логика фильтрации, чтобы корректно обрабатывать выбранные кабинеты во всех API-запросах

## 22.03.2025
- Добавлена утилита для объединения CSS классов (utils.ts)
- Создан компонент StatCard для отображения статистических данных на дашборде
- Создан компонент UsersTable для отображения и управления пользователями
- Исправлены импорты компонентов HeroUI для правильной работы библиотеки UI
- Обновлена структура проекта в документации

## 23.03.2025
- Удалены устаревшие зависимости от роутера post.ts
- Исправлены импорты компонентов Dropdown из HeroUI (@heroui/dropdown)
- Создан клиентский компонент Providers.tsx для обертки всех провайдеров
- Изменена архитектура приложения для работы с серверными/клиентскими компонентами Next.js
- Переработана главная страница для использования клиентских данных вместо серверных
- Создана индексная структура папок компонентов для лучшей поддержки типов
- Исправлена ошибка с использованием метаданных в клиентском компоненте (layout.tsx теперь серверный)

## 24.03.2025
- Исправлена ошибка уникального ограничения в `IdexTransaction` при синхронизации транзакций
- Улучшен механизм фильтрации существующих транзакций перед сохранением новых
- Добавлено логирование количества существующих транзакций для каждого кабинета
- Реализовано корректное сравнение составного ключа (externalId, cabinetId) для предотвращения дубликатов
- Добавлен механизм автоматических повторных попыток при временной недоступности базы данных Neon
- Реализована прогрессивная задержка между повторными попытками подключения к базе данных
- Улучшена обработка ошибок в процессе синхронизации транзакций из IDEX

## 25.03.2025
- Добавлен тип UserFromStorage для поддержки пользовательских данных из localStorage
- Создан объединенный тип AuthUser для совместимости с различными источниками данных
- Обновлена логика работы с токенами в authStore.ts и роутере auth.ts
- Добавлена генерация токена для авторизованных пользователей
- Улучшена совместимость между API и клиентской частью приложения
- Исправлены ошибки типизации в страницах и компонентах

## 26.03.2025
- Обновлена история проекта для отражения последних изменений в связи с решением проблем типизации и авторизации
- Произведено подключение к базе данных Neon с использованием обновленной строки подключения
- Добавлены диагностические инструменты для проверки работы аутентификации
- Обнаружено несоответствие между вводимым кодом доступа и значением в базе данных

## 27.03.2025
- Исправлена ошибка "Unsupported type <Item>" в компоненте UsersTable путем корректного использования структуры таблицы HeroUI
- Улучшена обработка данных пагинации в таблице пользователей
- Исправлена ошибка в AuthProvider, вызывающая циклические перенаправления между страницами
- Внедрен механизм предотвращения множественных перенаправлений с использованием состояния навигации
- Оптимизированы переходы между страницами с использованием router.replace вместо router.push

## 28.03.2025
- Исправлена ошибка уникального ограничения в `IdexTransaction` при синхронизации транзакций
- Улучшен механизм фильтрации существующих транзакций перед сохранением новых
- Добавлено логирование количества существующих транзакций для каждого кабинета
- Реализовано корректное сравнение составного ключа (externalId, cabinetId) для предотвращения дубликатов
- Добавлен механизм автоматических повторных попыток при временной недоступности базы данных Neon
- Реализована прогрессивная задержка между повторными попытками подключения к базе данных
- Улучшена обработка ошибок в процессе синхронизации транзакций из IDEX
